<head>
  <style> body { margin: 0; } </style>

  <script src="https://unpkg.com/globe.gl"></script>
  <!--<script src="../../dist/globe.gl.js"></script>-->
</head>

<body>
  <div id="globeViz"></div>

  <script>
    // Load country data for hex polygons
    fetch('https://unpkg.com/world-atlas@2.0.2/countries-110m.json')
    //fetch('https://github.com/vasturiano/globe.gl/blob/master/example/datasets/ne_110m_admin_0_countries.geojson')
      .then(res => res.json())
      .then(countries => {
        // Load student data from Airtable
        //const airtableUrl = 'https://airtable.com/appYqW8iuBgLtGOP2/shrE2LJ53HcVtEY61/Table06'; // Replace with your base ID and table name
        //const airtableUrl = 'https://airtable.com/appYqW8iuBgLtGOP2/shrtGjEj7qpf7yLvxv/Table06';
        const airtableUrl = 'https://api.airtable.com/v0/appYqW8iuBgLtGOP2/Table06';
        
        const personalAccessToken = 'patwqtFzx3a78vT6V.66fcfa8f307037aae0957ec9dfca266532922c280cd1d75cdcc33b4668413da5'; // Replace with your Airtable Personal Access Token


        fetch(airtableUrl, {
          headers: {
            Authorization: `Bearer ${personalAccessToken}` // Using Bearer token
          }
        })
          .then(res => res.json())
          .then(data => {
            const students = data.records.map(record => ({
              name: record.fields.Name, // Name of the student
              city: record.fields.City, // City of the student
              lat: record.fields.Latitude, // Latitude
              lng: record.fields.Longitude // Longitude
            }));

            // Initialize Globe
            const world = Globe({  antialias: true, alpha: true })
              .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-dark.jpg')
              .backgroundColor('rgba(0, 0, 0, 0)') // Set transparent background
              .hexPolygonsData(countries.features)
              .hexPolygonResolution(3)
              .hexPolygonMargin(0.3)
              .hexPolygonUseDots(true)
              .hexPolygonColor(() => `#${Math.round(Math.random() * Math.pow(2, 24)).toString(16).padStart(6, '0')}`)
              .hexPolygonLabel(({ properties: d }) => `
                <b>${d.ADMIN} (${d.ISO_A2})</b> <br />
                Population: <i>${d.POP_EST}</i>
              `)
              .pointsData(students)  // Add students' locations as points
              .pointAltitude(0.02)   // Adjust point height
              .pointColor(() => '#ff5722')  // Color of each student point
              .pointRadius(0.2)     // Size of each student point 0.15
              .pointLabel(({ name, city, lat, lng }) => `
                <b>${name}</b><br />
                City: <i>${city}</i><br />
                Latitude: <i>${lat}</i><br />
                Longitude: <i>${lng}</i>
              `)  // Label showing student name, city, latitude, and longitude
              (document.getElementById('globeViz'));

              world.controls().autoRotate = true;
              world.controls().autoRotateSpeed = 0.5; // Adjust the speed as desired
          })
          .catch(err => console.error('Error loading students data:', err));
      })
      .catch(err => console.error('Error loading countries data:', err));
  </script>
</body>